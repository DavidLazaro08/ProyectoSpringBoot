# ğŸ“Š AnÃ¡lisis del Modelo de Datos - Proyecto SaaS

## âœ… Resumen Ejecutivo

**Estado General:** âœ… **APROBADO CON OBSERVACIONES MENORES**

Tu modelo de datos cumple con **todos los requisitos del enunciado** y estÃ¡ bien diseÃ±ado. Las relaciones estÃ¡n correctamente normalizadas, la auditorÃ­a con Envers estÃ¡ implementada, y la herencia de mÃ©todos de pago sigue buenas prÃ¡cticas.

---

## ğŸ“‹ ValidaciÃ³n del Cumplimiento del Enunciado

| Requisito | Estado | Observaciones |
|-----------|--------|---------------|
| âœ… Entidad Usuario | **CUMPLE** | Correctamente implementada con email Ãºnico y fecha de alta |
| âœ… Entidad Perfil (1:1 con Usuario) | **CUMPLE** | RelaciÃ³n 1:1 bidireccional bien implementada |
| âœ… Entidad SuscripciÃ³n | **CUMPLE** | RelaciÃ³n con Usuario y Plan correcta |
| âœ… Entidad Plan | **CUMPLE** | CatÃ¡logo de planes (Basic, Premium, Enterprise) |
| âœ… Entidad Factura | **CUMPLE** | Generada por suscripciÃ³n (Many-to-One) |
| âœ… MÃ©todos de pago con herencia | **CUMPLE** | Estrategia JOINED correctamente aplicada |
| âœ… Enum EstadoSuscripcion | **CUMPLE** | ACTIVA, CANCELADA, MOROSA implementados |
| âœ… AuditorÃ­a con @Audited | **CUMPLE** | Hibernate Envers configurado en SuscripciÃ³n |
| âœ… Historial de cambios | **CUMPLE** | Envers auditarÃ¡ cambios en suscripciones |
| âœ… Relaciones normalizadas | **CUMPLE** | Sin redundancias detectadas |

---

## ğŸ” AnÃ¡lisis Detallado por Entidad

### 1ï¸âƒ£ **Usuario** (`usuarios`)

```java
@Entity
@Table(name = "usuarios")
public class Usuario
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `email` - String, UNIQUE, NOT NULL
- `pais` - String, NOT NULL
- `fechaAlta` - LocalDateTime, NOT NULL

**Relaciones:**
- `perfil` â†’ **1:1** con [Perfil](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#5-46) (lado inverso, `mappedBy`)

**âœ… Buenas prÃ¡cticas detectadas:**
- Email Ãºnico para evitar duplicados
- Constructor protegido para JPA
- Inmutabilidad (solo getters, sin setters)
- Fecha de alta automÃ¡tica en el constructor

**âš ï¸ Observaciones menores:**
- Considera agregar validaciÃ³n `@Email` en el campo email
- PodrÃ­as agregar un Ã­ndice en `pais` si planeas filtrar por paÃ­s frecuentemente

---

### 2ï¸âƒ£ **Perfil** (`perfiles`)

```java
@Entity
@Table(name = "perfiles")
public class Perfil
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `nombre` - String, NOT NULL
- `apellidos` - String, NOT NULL
- `telefono` - String, nullable
- `usuario_id` (FK) - UNIQUE, NOT NULL

**Relaciones:**
- `usuario` â†’ **1:1** con [Usuario](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Usuario.java#6-59) (lado propietario, `@JoinColumn`)

**âœ… Buenas prÃ¡cticas detectadas:**
- FK en el lado correcto (Perfil es dependiente de Usuario)
- `unique = true` garantiza la relaciÃ³n 1:1
- `optional = false` asegura integridad referencial

**âœ… DiseÃ±o correcto:** La decisiÃ³n de poner la FK en `perfiles` es acertada.

---

### 3ï¸âƒ£ **Plan** (`planes`)

```java
@Entity
@Table(name = "planes")
public class Plan
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `nombre` - String, UNIQUE, NOT NULL
- `precioMensual` - Double, NOT NULL

**Relaciones:**
- Ninguna explÃ­cita (es un catÃ¡logo referenciado por [Suscripcion](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Suscripcion.java#11-79))

**âœ… Buenas prÃ¡cticas detectadas:**
- Nombre Ãºnico para evitar duplicados (Basic, Premium, Enterprise)
- Entidad de catÃ¡logo simple y efectiva

**âš ï¸ Observaciones menores:**
- Considera usar `BigDecimal` en lugar de `Double` para precios (mejor precisiÃ³n monetaria)
- PodrÃ­as agregar un campo `activo` (boolean) para desactivar planes sin eliminarlos

---

### 4ï¸âƒ£ **SuscripciÃ³n** (`suscripciones`) â­ **AUDITADA**

```java
@Audited
@Entity
@Table(name = "suscripciones")
public class Suscripcion
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `usuario_id` (FK) - UNIQUE, NOT NULL
- `plan_id` (FK) - NOT NULL
- `estado` - Enum (ACTIVA, CANCELADA, MOROSA)
- `fechaInicio` - LocalDateTime, NOT NULL
- `fechaFinCiclo` - LocalDateTime, NOT NULL
- `fechaCancelacion` - LocalDateTime, nullable

**Relaciones:**
- `usuario` â†’ **1:1** con [Usuario](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Usuario.java#6-59) (simplificaciÃ³n defendible)
- `plan` â†’ **Many-to-One** con [Plan](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Plan.java#8-54)

**âœ… Buenas prÃ¡cticas detectadas:**
- `@Audited` correctamente aplicado
- `@Audited(targetAuditMode = NOT_AUDITED)` en relaciones para evitar auditar entidades de catÃ¡logo
- MÃ©todo de negocio [cancelar()](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Suscripcion.java#73-77) que actualiza estado y fecha
- Enum `EstadoSuscripcion` mapeado como STRING (legible en BD)

**âœ… AuditorÃ­a Envers:**
- Hibernate Envers crearÃ¡ automÃ¡ticamente la tabla `suscripciones_AUD`
- RegistrarÃ¡ todos los cambios de estado, plan, fechas, etc.

**âš ï¸ Observaciones:**
- La relaciÃ³n Usuario-SuscripciÃ³n es **1:1** (un usuario solo puede tener una suscripciÃ³n activa)
  - âœ… **Esto es defendible** para un proyecto acadÃ©mico
  - ğŸ’¡ En producciÃ³n real, podrÃ­a ser **1:N** (un usuario con mÃºltiples suscripciones histÃ³ricas)

---

### 5ï¸âƒ£ **Factura** (`facturas`)

```java
@Entity
@Table(name = "facturas")
public class Factura
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `suscripcion_id` (FK) - NOT NULL
- `importe` - Double, NOT NULL
- `fecha` - LocalDateTime, NOT NULL

**Relaciones:**
- `suscripcion` â†’ **Many-to-One** con [Suscripcion](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Suscripcion.java#11-79)

**âœ… Buenas prÃ¡cticas detectadas:**
- RelaciÃ³n correcta: una suscripciÃ³n puede generar mÃºltiples facturas
- Inmutabilidad (solo getters)

**âš ï¸ Observaciones menores:**
- Considera usar `BigDecimal` para `importe`
- PodrÃ­as agregar un campo `numero` (String, UNIQUE) para nÃºmero de factura
- Considera agregar un Ã­ndice en `suscripcion_id` para consultas frecuentes

---

### 6ï¸âƒ£ **Pago** (Clase abstracta) - Herencia JOINED

```java
@Entity
@Table(name = "pagos")
@Inheritance(strategy = InheritanceType.JOINED)
public abstract class Pago
```

**Atributos:**
- [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK) - Long, auto-incremental
- `factura_id` (FK) - UNIQUE, NOT NULL
- `importe` - Double, NOT NULL
- `fecha` - LocalDateTime, NOT NULL

**Relaciones:**
- `factura` â†’ **1:1** con [Factura](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Factura.java#6-37)

**Subclases:**

#### 6.1 **PagoTarjeta** (`pagos_tarjeta`)
- `ultimos4` - String
- `titular` - String

#### 6.2 **PagoPaypal** (`pagos_paypal`)
- `emailPaypal` - String

#### 6.3 **PagoTransferencia** (`pagos_transferencia`)
- `iban` - String
- `referencia` - String

**âœ… Buenas prÃ¡cticas detectadas:**
- **Estrategia JOINED** es la mÃ¡s normalizada y recomendada
- Cada tipo de pago tiene su propia tabla con campos especÃ­ficos
- Tabla padre `pagos` contiene campos comunes
- RelaciÃ³n 1:1 con Factura (un pago por factura)

**âœ… Estructura de tablas generada:**
```
pagos (id, factura_id, importe, fecha)
  â”œâ”€â”€ pagos_tarjeta (id, ultimos4, titular)
  â”œâ”€â”€ pagos_paypal (id, emailPaypal)
  â””â”€â”€ pagos_transferencia (id, iban, referencia)
```

**âš ï¸ Observaciones menores:**
- Considera agregar validaciones:
  - `@Column(length = 4)` en `ultimos4`
  - `@Email` en `emailPaypal`
  - ValidaciÃ³n de formato IBAN

---

## ğŸ—‚ï¸ Diagrama Entidad-RelaciÃ³n (E-R)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DIAGRAMA E-R COMPLETO                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      USUARIOS        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)           â”‚
â”‚    email (UNIQUE)    â”‚
â”‚    pais              â”‚
â”‚    fechaAlta         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1:1
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PERFILES        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)           â”‚
â”‚ ğŸ”— usuario_id (FK)   â”‚â—„â”€â”€â”€ UNIQUE (garantiza 1:1)
â”‚    nombre            â”‚
â”‚    apellidos         â”‚
â”‚    telefono          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PLANES         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)           â”‚
â”‚    nombre (UNIQUE)   â”‚â—„â”€â”€â”€ "Basic", "Premium", "Enterprise"
â”‚    precioMensual     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ N:1
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SUSCRIPCIONES ğŸ”        â”‚â—„â”€â”€â”€ @Audited (Envers)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)                   â”‚
â”‚ ğŸ”— usuario_id (FK, UNIQUE)   â”‚â—„â”€â”€â”€ 1:1 con Usuario
â”‚ ğŸ”— plan_id (FK)              â”‚â—„â”€â”€â”€ N:1 con Plan
â”‚    estado (ENUM)             â”‚â—„â”€â”€â”€ ACTIVA, CANCELADA, MOROSA
â”‚    fechaInicio               â”‚
â”‚    fechaFinCiclo             â”‚
â”‚    fechaCancelacion          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1:N
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FACTURAS        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)           â”‚
â”‚ ğŸ”— suscripcion_id    â”‚â—„â”€â”€â”€ N:1 con Suscripcion
â”‚    importe           â”‚
â”‚    fecha             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1:1
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGOS (Herencia JOINED)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”‘ id (PK)                                                   â”‚
â”‚ ğŸ”— factura_id (FK, UNIQUE) â—„â”€â”€â”€ 1:1 con Factura             â”‚
â”‚    importe                                                   â”‚
â”‚    fecha                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚             â”‚             â”‚             â”‚
           â–¼             â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚PAGOS_TARJETAâ”‚ â”‚PAGOS_PAYPAL â”‚ â”‚PAGOS_TRANSFEREN.â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ğŸ”— id (PK,FK)â”‚ â”‚ğŸ”— id (PK,FK)â”‚ â”‚ğŸ”— id (PK,FK)    â”‚
    â”‚  ultimos4   â”‚ â”‚ emailPaypal â”‚ â”‚  iban           â”‚
    â”‚  titular    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  referencia     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Resumen de Cardinalidades

| RelaciÃ³n | Cardinalidad | FK ubicada en | Constraint |
|----------|--------------|---------------|------------|
| Usuario â†” Perfil | **1:1** | `perfiles.usuario_id` | UNIQUE, NOT NULL |
| Usuario â†” Suscripcion | **1:1** | `suscripciones.usuario_id` | UNIQUE, NOT NULL |
| Plan â†” Suscripcion | **1:N** | `suscripciones.plan_id` | NOT NULL |
| Suscripcion â†” Factura | **1:N** | `facturas.suscripcion_id` | NOT NULL |
| Factura â†” Pago | **1:1** | `pagos.factura_id` | UNIQUE, NOT NULL |
| Pago â†” Subclases | **Herencia JOINED** | `pagos_*.id` | PK = FK |

---

## ğŸ¯ Claves Primarias y ForÃ¡neas

### Claves Primarias (PK)
- `usuarios.id`
- `perfiles.id`
- `planes.id`
- `suscripciones.id`
- `facturas.id`
- `pagos.id`
- `pagos_tarjeta.id` (tambiÃ©n FK a `pagos.id`)
- `pagos_paypal.id` (tambiÃ©n FK a `pagos.id`)
- `pagos_transferencia.id` (tambiÃ©n FK a `pagos.id`)

### Claves ForÃ¡neas (FK)
- `perfiles.usuario_id` â†’ `usuarios.id`
- `suscripciones.usuario_id` â†’ `usuarios.id`
- `suscripciones.plan_id` â†’ `planes.id`
- `facturas.suscripcion_id` â†’ `suscripciones.id`
- `pagos.factura_id` â†’ `facturas.id`
- `pagos_tarjeta.id` â†’ `pagos.id`
- `pagos_paypal.id` â†’ `pagos.id`
- `pagos_transferencia.id` â†’ `pagos.id`

---

## ğŸ” AnÃ¡lisis de AuditorÃ­a (Hibernate Envers)

### ConfiguraciÃ³n Detectada

âœ… **Dependencia correcta en [pom.xml](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/pom.xml):**
```xml
<dependency>
    <groupId>org.hibernate.orm</groupId>
    <artifactId>hibernate-envers</artifactId>
</dependency>
```

âœ… **Entidad auditada:**
```java
@Audited
@Entity
public class Suscripcion {
    @Audited(targetAuditMode = NOT_AUDITED)
    private Usuario usuario;
    
    @Audited(targetAuditMode = NOT_AUDITED)
    private Plan plan;
}
```

### Tablas de AuditorÃ­a Generadas

Envers crearÃ¡ automÃ¡ticamente:

1. **`suscripciones_AUD`** - HistÃ³rico de cambios
   - [id](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Perfil.java#42-43) (PK compuesta con REV)
   - `REV` (nÃºmero de revisiÃ³n)
   - `REVTYPE` (0=ADD, 1=MOD, 2=DEL)
   - `usuario_id`
   - `plan_id`
   - `estado`
   - `fechaInicio`
   - `fechaFinCiclo`
   - `fechaCancelacion`

2. **`REVINFO`** - InformaciÃ³n de revisiones
   - `REV` (PK)
   - `REVTSTMP` (timestamp)

### Ejemplo de Consulta de Historial

```java
AuditReader reader = AuditReaderFactory.get(entityManager);
List<Number> revisions = reader.getRevisions(Suscripcion.class, suscripcionId);

for (Number rev : revisions) {
    Suscripcion historico = reader.find(Suscripcion.class, suscripcionId, rev);
    // Ver estado anterior de la suscripciÃ³n
}
```

---

## âš ï¸ Observaciones y Recomendaciones

### ğŸŸ¢ Fortalezas del Modelo

1. âœ… **NormalizaciÃ³n correcta** - Sin redundancias
2. âœ… **Herencia bien implementada** - Estrategia JOINED es la mÃ¡s normalizada
3. âœ… **AuditorÃ­a configurada** - Envers funcionarÃ¡ correctamente
4. âœ… **Relaciones bien definidas** - Cardinalidades correctas
5. âœ… **Inmutabilidad** - Entidades sin setters innecesarios
6. âœ… **Constraints adecuados** - UNIQUE, NOT NULL bien aplicados

### ğŸŸ¡ Mejoras Sugeridas (Opcionales)

#### 1. **Tipos de datos monetarios**
```java
// Cambiar de Double a BigDecimal
@Column(nullable = false, precision = 10, scale = 2)
private BigDecimal precioMensual;
```

#### 2. **Validaciones adicionales**
```java
@Email
@Column(nullable = false, unique = true)
private String email;

@Pattern(regexp = "^[A-Z]{2}\\d{2}.*$")
private String iban;
```

#### 3. **Ãndices para rendimiento**
```java
@Table(name = "facturas", indexes = {
    @Index(name = "idx_factura_suscripcion", columnList = "suscripcion_id"),
    @Index(name = "idx_factura_fecha", columnList = "fecha")
})
```

#### 4. **Cascadas en relaciones**
```java
@OneToOne(mappedBy = "usuario", cascade = CascadeType.ALL, orphanRemoval = true)
private Perfil perfil;
```

#### 5. **AuditorÃ­a adicional**
Si quieres auditar tambiÃ©n [Plan](file:///c:/Users/Usuario/Documents/Grado%20S%20Programaci%C3%B3n%20-%20SEGUNDO/Desarrollo%20de%20Interfaces/SPRINTBOOT/PROYECTO%20FINAL/proyecto-saas/src/main/java/com/proyectospringboot/proyectosaas/domain/entity/Plan.java#8-54) (para ver cambios de precios):
```java
@Audited
@Entity
public class Plan { ... }
```

### ğŸ”´ Errores CrÃ­ticos Detectados

**NINGUNO** âœ… - El modelo estÃ¡ bien diseÃ±ado y cumple todos los requisitos.

---

## ğŸ“ ConclusiÃ³n Final

### âœ… **VEREDICTO: MODELO APROBADO**

Tu modelo de datos:
- âœ… Cumple **100% del enunciado**
- âœ… EstÃ¡ bien normalizado
- âœ… Usa correctamente Hibernate Envers
- âœ… Implementa herencia de tablas adecuadamente
- âœ… Tiene relaciones bien definidas
- âœ… Sigue buenas prÃ¡cticas de JPA

### ğŸ¯ PrÃ³ximos Pasos Recomendados

1. **Implementar validaciones** con Bean Validation (`@Email`, `@NotBlank`, etc.)
2. **Crear tests unitarios** para las entidades
3. **Probar la auditorÃ­a** creando/modificando suscripciones y consultando el historial
4. **Considerar DTOs** para la capa de presentaciÃ³n
5. **Documentar** el modelo con JavaDoc

---

## ğŸ“š Referencias

- [Hibernate Envers Documentation](https://hibernate.org/orm/envers/)
- [JPA Inheritance Strategies](https://www.baeldung.com/hibernate-inheritance)
- [Spring Data JPA Best Practices](https://www.baeldung.com/spring-data-jpa-query)

---

**AnÃ¡lisis realizado por:** Antigravity AI  
**Fecha:** 2026-02-05  
**Proyecto:** proyecto-saas (Spring Boot 4.0.2 + JPA + Hibernate Envers)
